<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[å¥‡æ€ªï¼ä¸ºä»€ä¹ˆä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®åˆ°ä¸€ä¸ªæ²¡æœ‰è¢«åˆå§‹åŒ–çš„å¯¹è±¡ï¼Ÿ]]></title>
      <url>/2017/08/10/%E5%BD%93%E4%B8%80%E4%B8%AA%E7%BA%BF%E7%A8%8B%E8%AE%BF%E9%97%AE%E4%BA%86%E4%B8%80%E4%B8%AA%E6%B2%A1%E6%9C%89%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E5%AF%B9%E8%B1%A1/</url>
      <content type="html"><![CDATA[<h1 id="ä¸šåŠ¡åœºæ™¯"><a href="#ä¸šåŠ¡åœºæ™¯" class="headerlink" title="ä¸šåŠ¡åœºæ™¯"></a>ä¸šåŠ¡åœºæ™¯</h1><p>   éš¾é“ä½ å°±ä¸å¥‡æ€ªï¼Œæ²¡æœ‰è¢«åˆå§‹åŒ–çš„å¯¹è±¡æ˜¯æ€ä¹ˆå‡ºç°çš„å—ï¼ŸğŸ˜³<br><a id="more"></a><br>   å¦‚æœä¸€ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–æ“ä½œéå¸¸æ˜‚è´µï¼Œè¿™æ—¶å€™å¯ä»¥è€ƒè™‘<font color="red"><strong>Lazy Initialization</strong></font>ã€‚<br>   æ¯”å¦‚è·å–æ•°æ®åº“è¿æ¥èµ„æºã€APPå¯åŠ¨é€Ÿåº¦è¿‡æ…¢ç­‰ã€‚<br>   ä½†æ˜¯è¦å®ç°çº¿ç¨‹å®‰å…¨çš„Lazy Initializationéœ€è¦ä¸€äº›æŠ€å·§ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€æ®µä»£ç ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnsafeLazyInitializationDemo</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Instance instance;</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Instance <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">if</span> (instance == <span class="keyword">null</span>) <span class="comment">//1ï¼šAçº¿ç¨‹æ‰§è¡Œ</span></div><div class="line">           instance = <span class="keyword">new</span> Instance(); <span class="comment">//2ï¼šBçº¿ç¨‹æ‰§è¡Œ</span></div><div class="line">      <span class="keyword">return</span> instance;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>å‡å¦‚é™æ€æ–¹æ³•getInstance()è¢«ä¸¤ä¸ªçº¿ç¨‹Aå’ŒBè®¿é—®ã€å½“Aæ‰§è¡Œåˆ°1çš„æ—¶å€™å¯èƒ½æ¡ä»¶è¯­å¥æ˜¯falseçš„ï¼Œç›´æ¥è¿”å›äº†è¿˜æœªè¢«åˆå§‹åŒ–instanceï¼Œåç»­ç”¨è¿™ä¸ªinstanceå¤„ç†ä¸€äº›é€»è¾‘å°±ä¼šå‡ºç°ä¸å¯é¢„çŸ¥çš„é—®é¢˜äº†ã€‚</p>
<p>é—®é¢˜å¤§æ¦‚çŸ¥é“äº†ï¼Œé‚£æœ‰ä»€ä¹ˆåŠæ³•è§£å†³å‘¢ï¼Ÿ<br>1ã€synchronizedåŒæ­¥ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeLazyInitializationDemo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Instance instance;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Instance <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</div><div class="line">            instance = <span class="keyword">new</span> Instance();</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<font color="green">synchronizedå°†å¯¼è‡´æ€§èƒ½å¼€é”€ã€‚å¦‚æœgetInstance()è¢«å¤šä¸ªçº¿ç¨‹é¢‘ç¹çš„è°ƒç”¨ï¼Œå°†ä¼šå¯¼è‡´ç¨‹åºæ‰§è¡Œæ€§èƒ½çš„ä¸‹é™</font>

</blockquote>
<p>2ã€è¿›é˜¶æ–¹æ¡ˆï¼šdouble-checked locking<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DoubleCheckedLockingDemo</span> </span>&#123;                  <span class="comment">//1</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Instance instance;                    <span class="comment">//2</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Instance <span class="title">getInstance</span><span class="params">()</span> </span>&#123;               <span class="comment">//3</span></div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;                          <span class="comment">//4:ç¬¬ä¸€æ¬¡æ£€æŸ¥</span></div><div class="line">            <span class="keyword">synchronized</span> (DoubleCheckedLocking.class) &#123;  <span class="comment">//5:åŠ é”</span></div><div class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>)                    <span class="comment">//6:ç¬¬äºŒæ¬¡æ£€æŸ¥</span></div><div class="line">                    instance = <span class="keyword">new</span> Instance();           <span class="comment">//7:é—®é¢˜çš„æ ¹æºå‡ºåœ¨è¿™é‡Œ</span></div><div class="line">            &#125;                                            <span class="comment">//8</span></div><div class="line">        &#125;                                                <span class="comment">//9</span></div><div class="line">        <span class="keyword">return</span> instance;                                 <span class="comment">//10</span></div><div class="line">    &#125;                                                    <span class="comment">//11</span></div><div class="line">&#125;                                                        <span class="comment">//12</span></div></pre></td></tr></table></figure></p>
<p>ä½†æ˜¯åœ¨æ‰§è¡Œåˆ°4çš„æ—¶å€™ï¼Œå’ŒUnsafeLazyInitializationDemoæœ‰åŒæ ·çš„é—®é¢˜ã€‚</p>
<h1 id="åˆ†æé—®é¢˜"><a href="#åˆ†æé—®é¢˜" class="headerlink" title="åˆ†æé—®é¢˜"></a>åˆ†æé—®é¢˜</h1><p>ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿè¿™æ ·çš„ç°è±¡å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºJVMå¯¹newæ“ä½œçš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<font color="red">1ã€memory = allocate();     //1ï¼šåˆ†é…å¯¹è±¡çš„å†…å­˜ç©ºé—´<br>2ã€ctorInstance(memory);    //2ï¼šåˆå§‹åŒ–å¯¹è±¡<br>3ã€instance = memory;       //3ï¼šè®¾ç½®instanceæŒ‡å‘åˆšåˆ†é…çš„å†…å­˜åœ°å€</font>

<p>å…¶ä¸­2å’Œ3å¯ä»¥æŒ‡ä»¤é‡æ’åºã€å•çº¿ç¨‹æŒ‡ä»¤é‡æ’åºå¯ä»¥æé«˜æ€§èƒ½</p>
<blockquote>
<p><font color="red"><em>The Java Language Specification, Java SE 7 Edition</em></font> çš„intra-thread semanticsè§„åˆ™ä¿è¯é‡æ’åºä¸ä¼šæ”¹å˜å•çº¿ç¨‹å†…çš„ç¨‹åºæ‰§è¡Œç»“æœ</p>
</blockquote>
<p>ä½†æ˜¯å¤šçº¿ç¨‹å°±ä¸èƒ½ä¿è¯äº†ï¼</p>
<p>é—®é¢˜æ ¹æºï¼š<br>1ã€ä¸å…è®¸2å’Œ3é‡æ’åºï¼›<br>2ã€å…è®¸2å’Œ3é‡æ’åºï¼Œä½†ä¸å…è®¸å…¶ä»–çº¿ç¨‹â€œçœ‹åˆ°â€è¿™ä¸ªé‡æ’åºã€‚<br>æˆ‘ä»¬å¯ä»¥æƒ³å‡ºä¸¤ä¸ªåŠæ³•æ¥å®ç°çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼š</p>
<h1 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h1><h2 id="åŸºäºvolatileçš„double-checked-lockingçš„è§£å†³æ–¹æ¡ˆ"><a href="#åŸºäºvolatileçš„double-checked-lockingçš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åŸºäºvolatileçš„double-checked lockingçš„è§£å†³æ–¹æ¡ˆ"></a>åŸºäºvolatileçš„double-checked lockingçš„è§£å†³æ–¹æ¡ˆ</h2><p>åŸç†ï¼šä¸å…è®¸2å’Œ3é‡æ’åº<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SafeDoubleCheckedLockingDemo</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Instance instance;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Instance <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">synchronized</span> (SafeDoubleCheckedLocking.class) &#123;</div><div class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>)</div><div class="line">                    instance = <span class="keyword">new</span> Instance();<span class="comment">//instanceä¸ºvolatileï¼Œç°åœ¨æ²¡é—®é¢˜äº†</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ"><a href="#åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ" class="headerlink" title="åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ"></a>åŸºäºç±»åˆå§‹åŒ–çš„è§£å†³æ–¹æ¡ˆ</h2><p>åŸç†ï¼šå…è®¸2å’Œ3é‡æ’åºï¼Œä½†ä¸å…è®¸å…¶ä»–çº¿ç¨‹â€œçœ‹åˆ°â€è¿™ä¸ªé‡æ’åº</p>
<blockquote>
<p>JVMåœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ˆå³åœ¨Classè¢«åŠ è½½åï¼Œä¸”è¢«çº¿ç¨‹ä½¿ç”¨ä¹‹å‰ï¼‰ï¼Œä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ã€‚åœ¨æ‰§è¡Œç±»çš„åˆå§‹åŒ–æœŸé—´ï¼ŒJVMä¼šå»è·å–ä¸€ä¸ªé”ã€‚è¿™ä¸ªé”å¯ä»¥åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ–ã€‚<br>æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹JVMçš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassLoaderDemo</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">InstanceHolder</span> </span>&#123;</div><div class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Instance instance = <span class="keyword">new</span> Instance();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Instance <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> InstanceHolder.instance ;  <span class="comment">//è¿™é‡Œå°†å¯¼è‡´InstanceHolderç±»è¢«åˆå§‹åŒ–</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–ä¸€ä¸ªç±»ï¼ŒåŒ…æ‹¬æ‰§è¡Œè¿™ä¸ªç±»çš„é™æ€åˆå§‹åŒ–å’Œåˆå§‹åŒ–åœ¨è¿™ä¸ªç±»ä¸­å£°æ˜çš„é™æ€å­—æ®µã€‚æ ¹æ®javaè¯­è¨€è§„èŒƒï¼Œåœ¨é¦–æ¬¡å‘ç”Ÿä¸‹åˆ—ä»»æ„ä¸€ç§æƒ…å†µæ—¶ï¼Œä¸€ä¸ªç±»æˆ–æ¥å£ç±»å‹Tå°†è¢«ç«‹å³åˆå§‹åŒ–ï¼š</p>
<blockquote>
<p>1ã€Tæ˜¯ä¸€ä¸ªç±»ï¼Œè€Œä¸”ä¸€ä¸ªTç±»å‹çš„å®ä¾‹è¢«åˆ›å»ºï¼›<br>2ã€Tæ˜¯ä¸€ä¸ªç±»ï¼Œä¸”Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€æ–¹æ³•è¢«è°ƒç”¨ï¼›<br>3ã€Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«èµ‹å€¼ï¼›<br>4ã€Tä¸­å£°æ˜çš„ä¸€ä¸ªé™æ€å­—æ®µè¢«ä½¿ç”¨ï¼Œè€Œä¸”è¿™ä¸ªå­—æ®µä¸æ˜¯ä¸€ä¸ªå¸¸é‡å­—æ®µï¼›<br>5ã€Tæ˜¯ä¸€ä¸ªé¡¶çº§ç±»ï¼ˆtop level classï¼Œè§javaè¯­è¨€è§„èŒƒçš„Â§7.6ï¼‰ï¼Œè€Œä¸”ä¸€ä¸ªæ–­è¨€è¯­å¥åµŒå¥—åœ¨Tå†…éƒ¨è¢«æ‰§è¡Œã€‚</p>
</blockquote>
<p>åœ¨ClassLoaderDemoç¤ºä¾‹ä»£ç ä¸­ï¼Œé¦–æ¬¡æ‰§è¡ŒgetInstance()çš„çº¿ç¨‹å°†å¯¼è‡´InstanceHolderç±»è¢«åˆå§‹åŒ–ï¼ˆç¬¦åˆæƒ…å†µ4ï¼‰ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¦‚æœç¡®å®éœ€è¦å¯¹å®ä¾‹å­—æ®µä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼Œè¯·ä½¿ç”¨ä¸Šé¢ä»‹ç»çš„åŸºäºvolatileçš„å»¶è¿Ÿåˆå§‹åŒ–çš„æ–¹æ¡ˆï¼›å¦‚æœç¡®å®éœ€è¦å¯¹é™æ€å­—æ®µä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„å»¶è¿Ÿåˆå§‹åŒ–ï¼Œè¯·ä½¿ç”¨ä¸Šé¢ä»‹ç»çš„åŸºäºç±»åˆå§‹åŒ–çš„æ–¹æ¡ˆ</p>
<blockquote>
<font color="red">Effective Java å»ºè®®æ…ç”¨Lazy Initialization</font>

</blockquote>
<h1 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h1><p>1ã€å•ä¾‹æ¨¡å¼<br>2ã€JVMç±»åŠ è½½<br>3ã€synchronizedå…³é”®å­—<br>4ã€volatileå…³é”®å­—</p>]]></content>
      
        <categories>
            
            <category> JavaåŸºç¡€ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Effective Java </tag>
            
            <tag> é¢å‘æ¨¡å¼çš„è½¯ä»¶ä½“ç³»æ¶æ„å·ä¸‰ä¸­Lazy Acquisitionæ¨¡å¼ </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
